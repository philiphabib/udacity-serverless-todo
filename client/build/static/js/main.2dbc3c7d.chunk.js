(this["webpackJsonptypescript-app"]=this["webpackJsonptypescript-app"]||[]).push([[0],{172:function(e,t,n){},203:function(e,t,n){"use strict";n.r(t);var a=n(58),o=n.n(a);n(172),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(173);var r=n(63),i=n(0),c=n(27),s=n(28),u=n(147),l="https://".concat("aesuwdqcje",".execute-api.us-east-1.amazonaws.com/dev"),d="dev-fdd0upkj.us.auth0.com",h="w1U7HGCZIuWJV7gvjnpDCTpdmNnWeu8j",p="http://localhost:3000/callback",j=function(){function e(t){Object(c.a)(this,e),this.auth0=new u.a.WebAuth({domain:d,clientID:h,redirectUri:p,responseType:"token id_token",scope:"openid"}),this.history=t,this.login=this.login.bind(this),this.logout=this.logout.bind(this),this.handleAuthentication=this.handleAuthentication.bind(this),this.isAuthenticated=this.isAuthenticated.bind(this),this.getAccessToken=this.getAccessToken.bind(this),this.getIdToken=this.getIdToken.bind(this),this.renewSession=this.renewSession.bind(this)}return Object(s.a)(e,[{key:"login",value:function(){this.auth0.authorize()}},{key:"handleAuthentication",value:function(){var e=this;this.auth0.parseHash((function(t,n){n&&n.accessToken&&n.idToken?(console.log("Access token: ",n.accessToken),console.log("id token: ",n.idToken),e.setSession(n)):t&&(e.history.replace("/"),console.log(t),alert("Error: ".concat(t.error,". Check the console for further details.")))}))}},{key:"getAccessToken",value:function(){return this.accessToken}},{key:"getIdToken",value:function(){return this.idToken}},{key:"setSession",value:function(e){localStorage.setItem("isLoggedIn","true");var t=1e3*e.expiresIn+(new Date).getTime();this.accessToken=e.accessToken,this.idToken=e.idToken,this.expiresAt=t,this.history.replace("/")}},{key:"renewSession",value:function(){var e=this;this.auth0.checkSession({},(function(t,n){n&&n.accessToken&&n.idToken?e.setSession(n):t&&(e.logout(),console.log(t),alert("Could not get a new token (".concat(t.error,": ").concat(t.error_description,").")))}))}},{key:"logout",value:function(){this.accessToken=null,this.idToken=null,this.expiresAt=0,localStorage.removeItem("isLoggedIn"),this.auth0.logout({return_to:window.location.origin}),this.history.replace("/")}},{key:"isAuthenticated",value:function(){var e=this.expiresAt;return(new Date).getTime()<e}}]),e}(),f=n(12),b=n(221),g=n(216),O=n(5);var v,x=function(){return Object(O.jsx)(b.a,{active:!0,children:Object(O.jsx)(g.a,{content:"Loading"})})},k=n(153),m=n.n(k),y=n(90),w=n(36),T=n(33),C=n(129),I=n(225),S=n(224),A=n(220),U=n(11),L=n.n(U),D=n(24),F=n(219),N=n(204),B=n(65),P=n.n(B);function z(e){return J.apply(this,arguments)}function J(){return(J=Object(D.a)(L.a.mark((function e(t){var n;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Fetching todos"),e.next=3,P.a.get("".concat(l,"/todos"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});case 3:return n=e.sent,console.log("Todos:",n.data),e.abrupt("return",n.data.items);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t){return _.apply(this,arguments)}function _(){return(_=Object(D.a)(L.a.mark((function e(t,n){var a;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.a.post("".concat(l,"/todos"),JSON.stringify(n),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});case 2:return a=e.sent,e.abrupt("return",a.data.item);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t,n){return M.apply(this,arguments)}function M(){return(M=Object(D.a)(L.a.mark((function e(t,n,a){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.a.patch("".concat(l,"/todos/").concat(n),JSON.stringify(a),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t){return H.apply(this,arguments)}function H(){return(H=Object(D.a)(L.a.mark((function e(t,n){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.a.delete("".concat(l,"/todos/").concat(n),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t){return q.apply(this,arguments)}function q(){return(q=Object(D.a)(L.a.mark((function e(t,n){var a;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.a.post("".concat(l,"/todos/").concat(n,"/attachment"),"",{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});case 2:return a=e.sent,e.abrupt("return",a.data.uploadUrl);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e,t){return V.apply(this,arguments)}function V(){return(V=Object(D.a)(L.a.mark((function e(t,n){return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.a.put(t,n);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e[e.NoUpload=0]="NoUpload",e[e.FetchingPresignedUrl=1]="FetchingPresignedUrl",e[e.UploadingFile=2]="UploadingFile"}(v||(v={}));var Z=function(e){Object(w.a)(n,e);var t=Object(T.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={file:void 0,uploadState:v.NoUpload},e.handleFileChange=function(t){var n=t.target.files;n&&e.setState({file:n[0]})},e.handleSubmit=function(){var t=Object(D.a)(L.a.mark((function t(n){var a;return L.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),t.prev=1,e.state.file){t.next=5;break}return alert("File should be selected"),t.abrupt("return");case 5:return e.setUploadState(v.FetchingPresignedUrl),t.next=8,$(e.props.auth.getIdToken(),e.props.match.params.todoId);case 8:return a=t.sent,e.setUploadState(v.UploadingFile),t.next=12,G(a,e.state.file);case 12:alert("File was uploaded!"),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(1),alert("Could not upload a file: ");case 18:return t.prev=18,e.setUploadState(v.NoUpload),t.finish(18);case 21:case"end":return t.stop()}}),t,null,[[1,15,18,21]])})));return function(e){return t.apply(this,arguments)}}(),e}return Object(s.a)(n,[{key:"setUploadState",value:function(e){this.setState({uploadState:e})}},{key:"render",value:function(){return Object(O.jsxs)("div",{children:[Object(O.jsx)("h1",{children:"Upload new image"}),Object(O.jsxs)(F.a,{onSubmit:this.handleSubmit,children:[Object(O.jsxs)(F.a.Field,{children:[Object(O.jsx)("label",{children:"File"}),Object(O.jsx)("input",{type:"file",accept:"image/*",placeholder:"Image to upload",onChange:this.handleFileChange})]}),this.renderButton()]})]})}},{key:"renderButton",value:function(){return Object(O.jsxs)("div",{children:[this.state.uploadState===v.FetchingPresignedUrl&&Object(O.jsx)("p",{children:"Uploading image metadata"}),this.state.uploadState===v.UploadingFile&&Object(O.jsx)("p",{children:"Uploading file"}),Object(O.jsx)(N.a,{loading:this.state.uploadState!==v.NoUpload,type:"submit",children:"Upload"})]})}}]),n}(i.PureComponent),K=function(e){Object(w.a)(n,e);var t=Object(T.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).onLogin=function(){e.props.auth.login()},e}return Object(s.a)(n,[{key:"render",value:function(){return Object(O.jsxs)("div",{children:[Object(O.jsx)("h1",{children:"Please log in"}),Object(O.jsx)(N.a,{onClick:this.onLogin,size:"huge",color:"olive",children:"Log in"})]})}}]),n}(i.PureComponent),Q=function(e){Object(w.a)(n,e);var t=Object(T.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return Object(O.jsx)("h1",{children:"Not Found"})}}]),n}(i.PureComponent),X=n(95),Y=n(154),ee=n(149),te=n.n(ee),ne=n(150),ae=n.n(ne),oe=n(223),re=n(217),ie=n(218),ce=n(226),se=n(64),ue=n(155),le=function(e){Object(w.a)(n,e);var t=Object(T.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={todos:[],newTodoName:"",loadingTodos:!0},e.handleNameChange=function(t){e.setState({newTodoName:t.target.value})},e.onEditButtonClick=function(t){e.props.history.push("/todos/".concat(t,"/edit"))},e.onTodoCreate=function(){var t=Object(D.a)(L.a.mark((function t(n){var a,o;return L.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=e.calculateDueDate(),t.next=4,W(e.props.auth.getIdToken(),{name:e.state.newTodoName,dueDate:a});case 4:o=t.sent,e.setState({todos:[].concat(Object(Y.a)(e.state.todos),[o]),newTodoName:""}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),alert("Todo creation failed");case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}(),e.onTodoDelete=function(){var t=Object(D.a)(L.a.mark((function t(n){return L.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,R(e.props.auth.getIdToken(),n);case 3:e.setState({todos:e.state.todos.filter((function(e){return e.todoId!==n}))}),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),alert("Todo deletion failed");case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e){return t.apply(this,arguments)}}(),e.onTodoCheck=function(){var t=Object(D.a)(L.a.mark((function t(n){var a;return L.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=e.state.todos[n],t.next=4,E(e.props.auth.getIdToken(),a.todoId,{name:a.name,dueDate:a.dueDate,done:!a.done});case 4:e.setState({todos:ae()(e.state.todos,Object(X.a)({},n,{done:{$set:!a.done}}))}),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),alert("Todo deletion failed");case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}(),e}return Object(s.a)(n,[{key:"componentDidMount",value:function(){var e=Object(D.a)(L.a.mark((function e(){var t;return L.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,z(this.props.auth.getIdToken());case 3:t=e.sent,this.setState({todos:t,loadingTodos:!1}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),alert("Failed to fetch todos");case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(O.jsxs)("div",{children:[Object(O.jsx)(oe.a,{as:"h1",children:"TODOs"}),this.renderCreateTodoInput(),this.renderTodos()]})}},{key:"renderCreateTodoInput",value:function(){return Object(O.jsxs)(S.a.Row,{children:[Object(O.jsx)(S.a.Column,{width:16,children:Object(O.jsx)(re.a,{action:{color:"teal",labelPosition:"left",icon:"add",content:"New task",onClick:this.onTodoCreate},fluid:!0,actionPosition:"left",placeholder:"To change the world...",onChange:this.handleNameChange})}),Object(O.jsx)(S.a.Column,{width:16,children:Object(O.jsx)(ie.a,{})})]})}},{key:"renderTodos",value:function(){return this.state.loadingTodos?this.renderLoading():this.renderTodosList()}},{key:"renderLoading",value:function(){return Object(O.jsx)(S.a.Row,{children:Object(O.jsx)(g.a,{indeterminate:!0,active:!0,inline:"centered",children:"Loading TODOs"})})}},{key:"renderTodosList",value:function(){var e=this;return Object(O.jsx)(S.a,{padded:!0,children:this.state.todos.map((function(t,n){return Object(O.jsxs)(S.a.Row,{children:[Object(O.jsx)(S.a.Column,{width:1,verticalAlign:"middle",children:Object(O.jsx)(ce.a,{onChange:function(){return e.onTodoCheck(n)},checked:t.done})}),Object(O.jsx)(S.a.Column,{width:10,verticalAlign:"middle",children:t.name}),Object(O.jsx)(S.a.Column,{width:3,floated:"right",children:t.dueDate}),Object(O.jsx)(S.a.Column,{width:1,floated:"right",children:Object(O.jsx)(N.a,{icon:!0,color:"blue",onClick:function(){return e.onEditButtonClick(t.todoId)},children:Object(O.jsx)(se.a,{name:"pencil"})})}),Object(O.jsx)(S.a.Column,{width:1,floated:"right",children:Object(O.jsx)(N.a,{icon:!0,color:"red",onClick:function(){return e.onTodoDelete(t.todoId)},children:Object(O.jsx)(se.a,{name:"delete"})})}),t.attachmentUrl&&Object(O.jsx)(ue.a,{src:t.attachmentUrl,size:"small",wrapped:!0}),Object(O.jsx)(S.a.Column,{width:16,children:Object(O.jsx)(ie.a,{})})]},t.todoId)}))})}},{key:"calculateDueDate",value:function(){var e=new Date;return e.setDate(e.getDate()+7),te()(e,"yyyy-mm-dd")}}]),n}(i.PureComponent),de=function(e){Object(w.a)(n,e);var t=Object(T.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).handleLogin=a.handleLogin.bind(Object(y.a)(a)),a.handleLogout=a.handleLogout.bind(Object(y.a)(a)),a}return Object(s.a)(n,[{key:"handleLogin",value:function(){this.props.auth.login()}},{key:"handleLogout",value:function(){this.props.auth.logout()}},{key:"render",value:function(){return Object(O.jsx)("div",{children:Object(O.jsx)(I.a,{style:{padding:"8em 0em"},vertical:!0,children:Object(O.jsx)(S.a,{container:!0,stackable:!0,verticalAlign:"middle",children:Object(O.jsx)(S.a.Row,{children:Object(O.jsx)(S.a.Column,{width:16,children:Object(O.jsxs)(f.b,{history:this.props.history,children:[this.generateMenu(),this.generateCurrentPage()]})})})})})})}},{key:"generateMenu",value:function(){return Object(O.jsxs)(A.a,{children:[Object(O.jsx)(A.a.Item,{name:"home",children:Object(O.jsx)(C.a,{to:"/",children:"Home"})}),Object(O.jsx)(A.a.Menu,{position:"right",children:this.logInLogOutButton()})]})}},{key:"logInLogOutButton",value:function(){return this.props.auth.isAuthenticated()?Object(O.jsx)(A.a.Item,{name:"logout",onClick:this.handleLogout,children:"Log Out"}):Object(O.jsx)(A.a.Item,{name:"login",onClick:this.handleLogin,children:"Log In"})}},{key:"generateCurrentPage",value:function(){var e=this;return this.props.auth.isAuthenticated()?Object(O.jsxs)(f.c,{children:[Object(O.jsx)(f.a,{path:"/",exact:!0,render:function(t){return Object(O.jsx)(le,Object(r.a)(Object(r.a)({},t),{},{auth:e.props.auth}))}}),Object(O.jsx)(f.a,{path:"/todos/:todoId/edit",exact:!0,render:function(t){return Object(O.jsx)(Z,Object(r.a)(Object(r.a)({},t),{},{auth:e.props.auth}))}}),Object(O.jsx)(f.a,{component:Q})]}):Object(O.jsx)(K,{auth:this.props.auth})}}]),n}(i.Component),he=m()(),pe=new j(he);o.a.render(Object(O.jsx)(f.b,{history:he,children:Object(O.jsxs)("div",{children:[Object(O.jsx)(f.a,{path:"/callback",render:function(e){return function(e){var t=e.location;/access_token|id_token|error/.test(t.hash)&&pe.handleAuthentication()}(e),Object(O.jsx)(x,{})}}),Object(O.jsx)(f.a,{render:function(e){return Object(O.jsx)(de,Object(r.a)({auth:pe},e))}})]})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[203,1,2]]]);
//# sourceMappingURL=main.2dbc3c7d.chunk.js.map